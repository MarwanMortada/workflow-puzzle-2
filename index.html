<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Workflow Automation Puzzle — Playable</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#1e90ff;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; margin:0; background:linear-gradient(180deg,#071024,#071834); color:#e6eef8; -webkit-font-smoothing:antialiased;}
  .wrap{max-width:1000px;margin:18px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .box{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6);}
  .panel{display:flex;gap:12px}
  .left{flex:1}
  .right{width:340px}
  .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
  .card{padding:10px;border-radius:8px;background:var(--glass);cursor:pointer;border:1px solid rgba(255,255,255,0.03);}
  .card small{color:var(--muted);display:block;margin-top:6px}
  .workflow{min-height:220px;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;flex-direction:column;gap:8px}
  .slot{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:6px;background:rgba(255,255,255,0.01);border:1px dashed rgba(255,255,255,0.03)}
  .slot .meta{font-size:12px;color:var(--muted)}
  .stats{display:flex;flex-direction:column;gap:6px;margin-top:10px}
  .statline{display:flex;justify-content:space-between;font-size:14px}
  button{background:var(--accent);color:#021124;border:0;padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
  .mutebtn{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .solutions{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .solution{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
  .score{font-weight:700;color:#00ff9d}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  .small{font-size:13px;color:var(--muted)}
  @media(max-width:880px){.panel{flex-direction:column}.right{width:100%}header{flex-direction:column;align-items:flex-start;gap:8px}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Workflow Automation Puzzle — Playable</h1>
    <div class="controls small">
      <span>Budget: <strong id="budgetTotal">25</strong></span>
      <span>Max steps: <strong id="maxSteps">12</strong></span>
      <span>Response SLA: <strong id="sla">2 hours</strong></span>
      <button id="reset" class="mutebtn">Reset</button>
    </div>
  </header>

  <div class="panel">
    <div class="left box">
      <div><strong>Scenario:</strong> Customer Inquiry process — start messy, redesign to meet SLA and optimize score.</div>
      <div style="margin-top:8px" class="small">Tap a card to add it to your workflow. Tap a slot to remove it. When finished, submit and then use "Share" to create a link other players can open to load your solution.</div>

      <div style="margin-top:12px">
        <div class="cards" id="cardPool"></div>
      </div>

      <h3 style="margin-top:14px">Build Workflow</h3>
      <div class="workflow" id="workflow"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="submit">Submit & Score</button>
        <button id="share" class="mutebtn">Share solution (link)</button>
        <button id="saveLocal" class="mutebtn">Save locally</button>
      </div>

      <div class="solutions" id="solutions"></div>
    </div>

    <aside class="right">
      <div class="box">
        <h4 style="margin:0">Status</h4>
        <div class="stats">
          <div class="statline"><span>Total cost</span><span id="totalCost">0</span></div>
          <div class="statline"><span>Estimated response time</span><span id="totalTime">0 min</span></div>
          <div class="statline"><span>Steps used</span><span id="stepsUsed">0</span></div>
          <div class="statline"><span>Budget left</span><span id="budgetLeft">25</span></div>
        </div>
        <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:10px 0">
        <div class="small">Submit results to get a score that balances cost, time, and intelligence.</div>
      </div>

      <div style="margin-top:10px" class="box">
        <h4 style="margin:0">Saved Solutions</h4>
        <div id="savedList" style="margin-top:8px"></div>
      </div>

      <div style="margin-top:10px" class="box small">
        <div><strong>How scoring works</strong></div>
        <ol style="padding-left:18px;margin:6px 0 0 0">
          <li>Cost optimization: cheaper gets more points</li>
          <li>Time efficiency: faster gets more points</li>
          <li>Workflow intelligence: proper use of automation & AI</li>
          <li>Creativity & realism</li>
        </ol>
      </div>
    </aside>
  </div>

  <footer>Built for mobile phones — tap to play. To host publicly, upload this file to GitHub Pages or Netlify. <span id="linkHint"></span></footer>
</div>

<script>
// Game configuration
const CONFIG = {
  budget: 25,
  maxSteps: 12,
  slaMinutes: 120 // 2 hours
};

const CARD_DEFS = [
  {id:'manual_review', name:'Manual: Review email', type:'manual', cost:1, time:8, desc:'Someone reads the email and decides next step.'},
  {id:'manual_reply', name:'Manual: Reply', type:'manual', cost:1, time:12, desc:'Human composes reply.'},
  {id:'manual_assign', name:'Manual: Assign', type:'manual', cost:1, time:4, desc:'Human assigns to teammate.'},

  {id:'auto_confirm', name:'Automation: Auto-confirm', type:'automation', cost:3, time:0.5, desc:'Send immediate confirmation.'},
  {id:'auto_log', name:'Automation: Log to CRM', type:'automation', cost:3, time:0.5, desc:'Automatically create CRM entry.'},
  {id:'auto_assign', name:'Automation: Assign rep', type:'automation', cost:3, time:0.2, desc:'Assign to available rep.'},
  {id:'auto_follow', name:'Automation: Schedule follow-up', type:'automation', cost:3, time:0.2, desc:'Schedule automatic reminders.'},

  {id:'ai_classify', name:'AI: Classify intent', type:'ai', cost:7, time:0.1, desc:'AI detects type: sales/support/urgent.'},
  {id:'ai_draft', name:'AI: Draft reply', type:'ai', cost:7, time:0.2, desc:'AI writes a personalized reply.'},
  {id:'ai_prioritize', name:'AI: Prioritize lead', type:'ai', cost:7, time:0.05, desc:'Predicts urgency/value.'},
  {id:'ai_summarize', name:'AI: Summarize request', type:'ai', cost:7, time:0.1, desc:'Creates a short summary for rep.'}
];

// UI initialisation
const cardPool = document.getElementById('cardPool');
const workflowEl = document.getElementById('workflow');
const totalCostEl = document.getElementById('totalCost');
const totalTimeEl = document.getElementById('totalTime');
const stepsUsedEl = document.getElementById('stepsUsed');
const budgetLeftEl = document.getElementById('budgetLeft');
const savedList = document.getElementById('savedList');
const solutionsEl = document.getElementById('solutions');

let state = { workflow: [] };

function formatTime(mins){
  if(mins < 1) return Math.round(mins*60)+' sec';
  if(mins >= 60) return Math.round(mins/60*10)/10 + ' hr';
  return Math.round(mins) + ' min';
}

// render card pool
CARD_DEFS.forEach(c=>{
  const d = document.createElement('div');
  d.className='card';
  d.innerHTML = `<strong>${c.name}</strong><small>${c.type.toUpperCase()} • Cost ${c.cost} • ${c.time} min est</small>`;
  d.title = c.desc;
  d.onclick = ()=> addCardToWorkflow(c.id);
  cardPool.appendChild(d);
});

function addCardToWorkflow(cardId){
  if(state.workflow.length >= CONFIG.maxSteps){ alert('Max steps reached'); return; }
  const card = CARD_DEFS.find(x=>x.id===cardId);
  state.workflow.push({ ...card, uid:Date.now()+Math.random() });
  renderWorkflow();
}

function removeStep(uid){
  state.workflow = state.workflow.filter(s=>s.uid!==uid);
  renderWorkflow();
}

function renderWorkflow(){
  workflowEl.innerHTML='';
  state.workflow.forEach(s=>{
    const slot = document.createElement('div');
    slot.className='slot';
    slot.innerHTML = `<div><strong>${s.name}</strong><div class="meta">${s.type.toUpperCase()} • Cost ${s.cost} • ${s.time} min</div></div><div><button class="mutebtn" onclick="removeStep(${s.uid})">Remove</button></div>`;
    workflowEl.appendChild(slot);
  });
  updateStats();
}

// compute totals
function updateStats(){
  const totalCost = state.workflow.reduce((a,b)=>a+b.cost,0);
  const totalTime = state.workflow.reduce((a,b)=>a+b.time,0);
  totalCostEl.textContent = totalCost;
  totalTimeEl.textContent = formatTime(totalTime);
  stepsUsedEl.textContent = state.workflow.length;
  budgetLeftEl.textContent = CONFIG.budget - totalCost;
}

// scoring
function scoreSolution(solution){
  // costScore: 0-10 (lower cost better)
  const totalCost = solution.reduce((a,b)=>a+b.cost,0);
  let costScore = Math.max(0, 10 - Math.round((totalCost / CONFIG.budget) * 10));
  // timeScore: 0-10 (faster better)
  const totalTime = solution.reduce((a,b)=>a+b.time,0);
  // if meets SLA fully get more
  let timeScore = 0;
  if(totalTime*60 <= CONFIG.slaMinutes*60) timeScore = Math.max(0, 10 - Math.round((totalTime / CONFIG.slaMinutes) * 10));
  // intelligenceScore: reward proper use of automation & AI
  const counts = solution.reduce((acc,s)=>{acc[s.type]=(acc[s.type]||0)+1; return acc;},{});
  // penalize too many manuals, penalize too many AI without automation
  let intelligenceScore = 5;
  if((counts.manual||0) > (counts.automation||0) + 2) intelligenceScore -= 2;
  if((counts.ai||0) > 2 && (counts.automation||0)===0) intelligenceScore -= 2;
  intelligenceScore += Math.min(3, (counts.automation||0));
  intelligenceScore = Math.max(0, Math.min(10, intelligenceScore));
  // creativity: short heuristic - varied card types and less wasted cost
  const variety = Object.keys(counts).length;
  let creativity = Math.min(10, Math.round(variety * 3 + (CONFIG.budget - totalCost)/5));
  // final score weighted
  const final = Math.round( (costScore*0.25 + timeScore*0.35 + intelligenceScore*0.25 + creativity*0.15) * 10 )/10;
  return {totalCost, totalTime, costScore,timeScore,intelligenceScore,creativity,final};
}

// submit handler
document.getElementById('submit').onclick = ()=>{
  if(state.workflow.length===0){ alert('Build a workflow first'); return; }
  const res = scoreSolution(state.workflow);
  const div = document.createElement('div');
  div.className='solution';
  div.innerHTML = `<div><strong>Your Score: <span class="score">${res.final}</span>/10</strong></div>
  <div class="small">Cost: ${res.totalCost} • Time: ${formatTime(res.totalTime)} • Details: cost(${res.costScore}) time(${res.timeScore}) intelligence(${res.intelligenceScore}) creativity(${res.creativity})</div>`;
  solutionsEl.prepend(div);
  // save last result to localStorage snapshot
  const snapshot = {workflow:state.workflow, score:res, ts:Date.now()};
  localStorage.setItem('lastSolution', JSON.stringify(snapshot));
  alert('Scored: ' + res.final + ' — Solution saved locally. Use Share to create a link.');
};

// share via URL hash
document.getElementById('share').onclick = ()=>{
  if(state.workflow.length===0){ alert('Build a workflow first'); return; }
  const minimal = state.workflow.map(s=>s.id);
  const payload = {w:minimal, name:prompt('Solution name (optional):')||'Anonymous'};
  const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
  const url = location.href.split('#')[0] + '#' + encoded;
  navigator.clipboard && navigator.clipboard.writeText(url);
  prompt('Shareable link copied to clipboard — paste it to share. (Also saved to clipboard)', url);
};

// load shared from hash
function loadFromHash(){
  if(location.hash && location.hash.length>1){
    try{
      const encoded = location.hash.slice(1);
      const decoded = decodeURIComponent(escape(atob(encoded)));
      const payload = JSON.parse(decoded);
      if(payload && payload.w){
        // build workflow from ids
        state.workflow = payload.w.map(id => {
          const def = CARD_DEFS.find(c=>c.id===id);
          return {...def, uid:Date.now()+Math.random()};
        });
        renderWorkflow();
        const s = document.createElement('div'); s.className='solution'; s.innerHTML=`<div>Loaded shared solution: <strong>${payload.name||'Shared'}</strong></div>`;
        solutionsEl.prepend(s);
      }
    }catch(e){ console.warn('Invalid share hash', e); }
  }
}

// Save locally
document.getElementById('saveLocal').onclick = ()=>{
  if(state.workflow.length===0){ alert('Nothing to save'); return; }
  const name = prompt('Name this saved solution:')||('Solution '+new Date().toLocaleString());
  const entry = {name, workflow: state.workflow.map(s=>s.id), ts:Date.now()};
  const arr = JSON.parse(localStorage.getItem('savedSolutions')||'[]');
  arr.push(entry);
  localStorage.setItem('savedSolutions', JSON.stringify(arr));
  renderSaved();
  alert('Saved locally — visible on this device only.');
};

function renderSaved(){
  const arr = JSON.parse(localStorage.getItem('savedSolutions')||'[]');
  savedList.innerHTML='';
  if(arr.length===0){ savedList.innerHTML='<div class="small">No saved solutions</div>'; return; }
  arr.slice().reverse().forEach((e,i)=>{
    const d = document.createElement('div'); d.className='small';
    d.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px;align-items:center;padding:6px 0"><div><strong>${e.name}</strong><div class="small">${new Date(e.ts).toLocaleString()}</div></div><div><button class="mutebtn" onclick='loadSaved(${JSON.stringify(e).replace(/'/g,"\\'")})'>Load</button></div></div>`;
    savedList.appendChild(d);
  });
}

window.loadSaved = function(e){
  if(!e || !e.workflow) return;
  state.workflow = e.workflow.map(id => {
    const def = CARD_DEFS.find(c=>c.id===id);
    return {...def, uid:Date.now()+Math.random()};
  });
  renderWorkflow();
};

document.getElementById('reset').onclick = ()=>{
  if(confirm('Clear workflow?')){ state.workflow=[]; renderWorkflow(); }
};

// init
document.getElementById('budgetTotal').textContent = CONFIG.budget;
document.getElementById('maxSteps').textContent = CONFIG.maxSteps;
document.getElementById('sla').textContent = '2 hours';
renderSaved();
loadFromHash();
renderWorkflow();
</script>
</body>
</html>
